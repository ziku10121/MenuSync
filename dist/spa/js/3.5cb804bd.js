(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{1:function(t,e){},10:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},6:function(t,e){},7:function(t,e){},8:function(t,e){},9:function(t,e){},"93cd":function(t,e,s){"use strict";s("c98f")},b74d:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("q-dialog",{model:{value:t.isSuccess,callback:function(e){t.isSuccess=e},expression:"isSuccess"}},[e("q-card",{staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row items-center bg-green-8 text-grey-3"},[e("div",{staticClass:"text-h6"},[t._v(t._s(t.successText))]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:t.closeBtn}})],1),e("q-card-section",{staticClass:"text-grey-9 text-center"},[e("q-icon",{staticClass:"q-pt-lg",staticStyle:{"font-size":"80px"},attrs:{name:"o_check_circle"}}),e("div",{staticStyle:{"font-size":"28px","line-height":"50px"}},[t._v("\n                "+t._s(t.successText)+" Success!\n            ")])],1),e("q-card-actions",{staticClass:"bg-white",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK"},on:{click:t.closeBtn}})],1)],1)],1)},r=[],a={name:"errorMsg",props:{success:Boolean,msg:String},data(){return{isSuccess:null,successText:""}},watch:{success(){this.isSuccess=this.success,this.successText=this.msg}},mounted(){},methods:{closeBtn(){this.$emit("returnOk",!1)}}},o=a,c=s("2877"),n=s("24e8"),l=s("f09f"),d=s("a370"),m=s("2c91"),u=s("9c40"),h=s("0016"),g=s("4b7e"),p=s("7f67"),v=s("eebe"),b=s.n(v),f=Object(c["a"])(o,i,r,!1,null,null,null);e["a"]=f.exports;b()(f,"components",{QDialog:n["a"],QCard:l["a"],QCardSection:d["a"],QSpace:m["a"],QBtn:u["a"],QIcon:h["a"],QCardActions:g["a"]}),b()(f,"directives",{ClosePopup:p["a"]})},bb52:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("q-page",[e("div",{staticClass:"column items-center py-30"},[e("q-card",{staticClass:"my-card q-pa-md",attrs:{flat:"",bordered:""}},[e("div",{staticClass:"wrap"},[t.isLive?e("div",{staticClass:"q-mt-xl"},[e("div",{staticClass:"row justify-center"},[e("div",{staticClass:"video"},[e("img",{attrs:{src:t.imgSrc,width:"1080",height:"768"}}),t.streaming?e("div",{staticClass:"caption live"},[e("b",[t._v("LIVE")])]):t._e()]),e("div",{staticClass:"col-12 text-center"},[t._v("\n                            "+t._s(t.imgName)+"\n                        ")])]),e("div",{staticClass:"row items-center justify-center q-mt-lg"},[t.streaming?t._e():e("q-btn",{staticClass:"q-mx-md",attrs:{round:"",color:"primary"},on:{click:function(e){t.startLive(),t.showBack=!1}}},[e("q-icon",{attrs:{name:"reply"}}),e("q-tooltip",{model:{value:t.showBack,callback:function(e){t.showBack=e},expression:"showBack"}},[t._v("返回")])],1),e("q-btn",{staticClass:"q-mx-md",attrs:{round:"",color:"primary",disabled:!t.streaming},on:{click:function(e){return t.capture()}}},[e("q-icon",{attrs:{name:"screenshot_monitor"}}),e("q-tooltip",{model:{value:t.showCap,callback:function(e){t.showCap=e},expression:"showCap"}},[t._v("截圖")])],1)],1),e("div",{staticClass:"row justify-end"},[e("div",{staticClass:"col-auto"},[e("q-btn",{attrs:{color:"primary",label:"偵測",disabled:t.streaming},on:{click:function(e){t.postSetup("detect"),t.showLoading()}}})],1)])]):e("div",[e("div",{staticClass:"q-pt-md",staticStyle:{position:"relative"}},[e("img",{staticStyle:{margin:"auto",border:"3px solid #2d2d2d"},attrs:{id:"img",src:t.imgSrc,width:"100%",height:"auto"}}),"ok"===t.get_detect.status?e("div",[e("div",{staticClass:"row items-center q-mt-md q-px-md bg-primary text-white",staticStyle:{"border-radius":"10px 10px 0 0",height:"50px"}},[e("div",{staticClass:"col-auto text-h5"},[t._v("\n                                    Detect food result\n                                ")]),e("div",{staticClass:"col-auto q-ml-md bg-teal",staticStyle:{"border-radius":"5px",padding:"5px"}},[t._v("\n                                    "+t._s(t.foodType)+"種菜名\n                                ")]),e("div",{staticClass:"col-auto q-ml-md bg-purple",staticStyle:{"border-radius":"5px",padding:"5px"}},[t._v("\n                                    共計"+t._s(t.foodNum)+"道菜\n                                ")])]),e("div",{staticStyle:{border:"1px solid rgba(0, 0, 0, 0.12)"}},[e("q-scroll-area",{staticStyle:{height:"340px","max-width":"100%"},attrs:{visible:!0}},[e("q-card",{staticClass:"row q-pa-sm items-center justify-center",attrs:{flat:""}},[e("div",{staticClass:"row"},t._l(26,(function(s){return e("div",{key:s,staticClass:"col-2 text-grey-10"},[e("q-card",{staticStyle:{margin:"8px"},attrs:{flat:"",bordered:""}},[e("q-card-section",{staticClass:"items-center",attrs:{horizontal:""}},[e("q-card-section",{staticClass:"col"},[e("div",{staticClass:"q-pb-md text-orange-9"},[t._v("麵類")]),e("div",{staticClass:"text-h6"},[t._v("客家湯圓")]),e("div",{staticClass:"text-body"},[t._v("\n                                                                NT$ 40\n                                                            ")]),e("a",{staticClass:"text-caption text-red"},[t._v("\n                                                                麵\n                                                            ")]),e("a",{staticClass:"text-caption text-red"},[t._v("\n                                                                加量\n                                                            ")])]),e("q-card-section",{staticClass:"q-pa-none q-pr-md col-auto",staticStyle:{"font-size":"20px"}},[t._v("\n                                                            X1\n                                                        ")])],1)],1)],1)})),0)])],1)],1)]):e("div",[e("div",{staticClass:"row items-center q-mt-md q-px-md bg-negative text-white",staticStyle:{"border-radius":"10px 10px 0 0",height:"50px"}},[e("div",{staticClass:"col-auto text-h5"},[t._v("\n                                    Error Message\n                                ")])]),e("div",{staticStyle:{border:"1px solid rgba(0, 0, 0, 0.12)"}},[e("div",{staticClass:"q-py-lg q-px-sm"},[t._v("\n                                    "+t._s(t.get_detect.error_msg)+"\n                                ")])])])]),e("div",{staticClass:"row q-py-md"},[e("div",{staticClass:"col q-pr-md"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msg,expression:"msg"}],staticClass:"full-width text-caption",staticStyle:{"font-size":"16px",height:"100%"},attrs:{rows:"3",readonly:""},domProps:{value:t.msg},on:{input:function(e){e.target.composing||(t.msg=e.target.value)}}})]),"ok"==t.get_detect.status?e("div",{staticClass:"col-auto q-mr-md"},[e("q-btn",{staticStyle:{height:"100%"},attrs:{color:"negative",label:"重測"},on:{click:function(e){return t.$router.push({path:"capture"})}}})],1):t._e(),e("div",{staticClass:"col-auto"},[e("q-btn",{staticStyle:{height:"100%"},attrs:{color:"primary",label:"完成"},on:{click:function(e){return t.postSetup("confirm")}}})],1)])])]),e("errorMsg",{attrs:{err:t.msgObj.isError,num:t.msgObj.num,msg:t.msgObj.errormsg},on:{returnOk:t.get_error}}),e("successMsg",{attrs:{success:t.msgObj.isSuccess,msg:t.msgObj.successmsg},on:{returnOk:t.get_success}})],1)],1)])},r=[],a=s("f5084"),o=s("0d59"),c=(s("5118"),s("ac5e")),n=(s("e7fc"),s("7129")),l=s("beb3"),d=s("b74d"),m={name:"machineTest",components:{errorMsg:l["a"],successMsg:d["a"]},data(){return{streaming:!1,loadtimer:null,loadingdelay:15,bgkey:"",timer:null,menu_data:null,get_detect:null,isLive:!1,imgSrc:null,imgName:null,tempImg:null,foodType:0,foodNum:0,msg:"",msgObj:{isSuccess:!1,isError:!1,num:0,errormsg:"",successmsg:""},setupUrl:"",showBack:!1,showCap:!1}},created(){this.subscribe_topic="menu/#",this.$mqtt.subscribe(this.subscribe_topic),console.log("subscribe(menu/#)");let t=sessionStorage.getItem("menuFormat"),e=sessionStorage.getItem("detect");void 0!=t&&null!=t&&""!=t&&void 0!=e&&null!=e&&""!=e||this.$router.push({path:"capture"}),this.menu_data=JSON.parse(t),this.setupUrl=c["a"],this.init()},mqtt:{"menu/#"(t,e){"menu/from_server/start"===e&&this.isLive&&(this.get_detect=JSON.parse(t),this.streaming&&(this.imgSrc=this.get_detect.img_url,this.imgName=this.get_detect.img_name)),"menu/from_server/detect"===e&&(this.get_detect=JSON.parse(t),console.log("mqtt get_detect:",this.get_detect),this.isLive=!1,this.imgSrc=this.get_detect.img_url,this.msg=JSON.stringify(this.get_detect.msg),this.foodType=this.get_detect.result.length,this.imgName=this.get_detect.img_name,this.hideLoading(),this.conguration())}},mounted(){let t=this;t.menu_data&&t.startLive(),window.addEventListener("keydown",(function(e){""==t.bgkey&&t.openKey(5),e.keyCode>=65&&e.keyCode<=90&&(t.bgkey+=e.key),"Enter"==e.key&&("stoplive"===t.bgkey&&1==t.streaming&&t.stopLive(),"startlive"===t.bgkey&&0==t.streaming&&t.startLive(),t.clearKey())}),!1)},methods:{init(){this.get_detect=null,this.isLive=!0,this.imgSrc=null,this.imgName=null,this.tempImg=null,this.foodType=0,this.foodNum=0,this.msg=""},startLive(){this.streaming=!0,this.postSetup("start")},stopLive(){this.streaming=!1,this.postSetup("stop")},detectLive(){this.streaming=!1,this.postSetup("detect")},capture(){this.streaming&&(this.stopLive(),this.showCap=!1),this.tempPhoto()},tempPhoto(){this.tempImg=this.get_detect,this.imgSrc=this.tempImg.img_url,this.imgName=this.tempImg.img_name},postSetup(t){let e=this,s={command:"",img_name:""};s.command=t,"detect"!=t&&"confirm"!=t||(s.img_name=e.tempImg.img_name),fetch(e.setupUrl,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then((t=>t.json())).catch((t=>{console.error("Error:",t),e.errorMethod(4)})).then((function(t){"ok"==t.status?("confirm"==t.command&&e.$router.push({name:"main"}),console.log("api回報：",t),e.hideLoading()):(e.hideLoading(),e.errorMethod(5))}),window)},showLoading(){this.show({spinner:o["a"],spinnerSize:140,message:"照片上傳中，請稍等..."})},show(t){let e=this;a["a"].show(t),e.loadtimer=setTimeout((()=>{e.errorMethod(1),a["a"].hide(),e.loadtimer=null,e.startLive()}),1e3*e.loadingdelay)},hideLoading(){let t=this;a["a"].hide(),window.clearTimeout(t.loadtimer),t.loadtimer=null},errorMethod(t){switch(t){case 1:this.errorText="抓取時間逾期!!";break;case 2:this.errorText="讀取資料錯誤！！";break;default:this.errorText="操作錯誤！！";break}this.isError=!0},get_error(t){this.msgObj.isError=t},get_success(t){this.msgObj.isSuccess=t},openKey(t){let e=this;this.timer=setTimeout((function(){e.clearKey()}),1e3*t)},clearKey(){this.bgkey="",null!=this.timer&&window.clearTimeout(this.timer)},conguration(){let t=3e3,e=Date.now()+t,s={startVelocity:30,spread:360,ticks:60,zIndex:0};function i(t,e){return Math.random()*(e-t)+t}let r=setInterval((function(){let a=e-Date.now();if(a<=0)return clearInterval(r);let o=a/t*50;Object(n["a"])(Object.assign({},s,{particleCount:o,origin:{x:i(.1,.3),y:Math.random()-.2}})),Object(n["a"])(Object.assign({},s,{particleCount:o,origin:{x:i(.7,.9),y:Math.random()-.2}}))}),300)}}},u=m,h=(s("93cd"),s("2877")),g=s("9989"),p=s("f09f"),v=s("9c40"),b=s("0016"),f=s("05c0"),x=s("4983"),_=s("068f"),y=s("a370"),C=s("eebe"),w=s.n(C),S=Object(h["a"])(u,i,r,!1,null,"6d3d96b0",null);e["default"]=S.exports;w()(S,"components",{QPage:g["a"],QCard:p["a"],QBtn:v["a"],QIcon:b["a"],QTooltip:f["a"],QScrollArea:x["a"],QImg:_["a"],QCardSection:y["a"]})},beb3:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("q-dialog",{model:{value:t.isError,callback:function(e){t.isError=e},expression:"isError"}},[e("q-card",{staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row items-center bg-red-8 text-grey-3"},[e("div",{staticClass:"text-h6"},[t._v("Error")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:t.closeBtn}})],1),e("q-card-section",{staticClass:"text-grey-9 text-center"},[e("q-icon",{staticClass:"q-pt-lg",staticStyle:{"font-size":"80px"},attrs:{name:"error_outline"}}),e("div",{staticStyle:{"font-size":"26px","line-height":"50px"},attrs:{id:"errorMessage"}},[t._v("\n                "+t._s(t.errorText)+"\n            ")])],1),e("q-card-actions",{staticClass:"bg-white",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK"},on:{click:t.closeBtn}})],1)],1)],1)},r=[],a={name:"errorMsg",props:{err:Boolean,num:Number,msg:String},data(){return{isError:null,isSuccess:null,errorText:""}},watch:{err(){this.isError=this.err,this.errorMethod(this.num,this.msg)}},methods:{errorMethod(t,e){switch(t){case 1:this.errorText="Timeout(1)";break;case 2:this.errorText="System error(2)";break;case 3:this.errorText="Can't find camera(3)";break;case 4:this.errorText="Web api error(4)";break;case 5:this.errorText="Data error(5)";break;case 6:this.errorText="Setting data not ready(6)";break;case 7:this.errorText="The detected area must be within 2(7)";break;case 8:this.errorText="Format error(8)";break;case 99:this.errorText=e+"(99)";break;default:this.errorText="Operation error(0)";break}},closeBtn(){this.$emit("returnOk",!1)}}},o=a,c=s("2877"),n=s("24e8"),l=s("f09f"),d=s("a370"),m=s("2c91"),u=s("9c40"),h=s("0016"),g=s("4b7e"),p=s("7f67"),v=s("eebe"),b=s.n(v),f=Object(c["a"])(o,i,r,!1,null,null,null);e["a"]=f.exports;b()(f,"components",{QDialog:n["a"],QCard:l["a"],QCardSection:d["a"],QSpace:m["a"],QBtn:u["a"],QIcon:h["a"],QCardActions:g["a"]}),b()(f,"directives",{ClosePopup:p["a"]})},c98f:function(t,e,s){}}]);
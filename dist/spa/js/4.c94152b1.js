(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{1:function(t,e){},10:function(t,e){},"135f":function(t,e,s){"use strict";s("b3f5")},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},"52b8":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("q-page",[e("div",{staticClass:"column items-center py-30"},[e("q-card",{staticClass:"my-card q-pa-md",attrs:{flat:"",bordered:""}},[e("q-card-section",[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm col-1"},[t._v("\n            載入舊檔:\n          ")]),e("div",{staticClass:"col-3"},[e("q-file",{attrs:{color:"black",label:"Json",accept:".json",filled:""},on:{input:function(e){return t.upLoadFile(e)}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("q-icon",{attrs:{name:"cloud_upload"},on:{click:function(t){t.stopPropagation()}}})]},proxy:!0}]),model:{value:t.json_file,callback:function(e){t.json_file=e},expression:"json_file"}})],1)])]),e("q-card-section",[e("div",{staticClass:"row items-start"},[e("div",{staticClass:"q-pr-sm q-pt-md col-1"},[t._v("\n            Logo圖片:\n          ")]),e("div",{staticClass:"col-auto"},[e("q-file",{staticClass:"upload_file",attrs:{color:"black",label:"Image",accept:".png,.jpeg,.jpg,.gif",filled:"","input-style":{height:"115px",width:"220px"}},on:{input:function(e){return t.upLoadImage(e)}},scopedSlots:t._u([{key:"prepend",fn:function(){return[t.logo_b64string?t._e():e("q-icon",{staticClass:"upload_icon",attrs:{name:"cloud_upload"},on:{click:function(t){t.stopPropagation()}}}),t.logo_b64string?e("img",{staticClass:"upload_img",attrs:{src:t.logo_b64string}}):t._e()]},proxy:!0},{key:"append",fn:function(){return[t.logo_b64string?e("q-icon",{staticClass:"upload_del",attrs:{name:"o_cancel"},on:{click:t.rmUploadImg}}):t._e()]},proxy:!0}])})],1)]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-1"}),e("div",{staticClass:"col-auto"},[e("small",[t._v("僅限於png、jpeg、jpg、gif格式，建議圖片：110*220。")])])])]),e("q-card-section",[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm col-1"},[t._v("\n            設定:\n          ")]),e("div",{staticClass:"col"},[e("div",{staticClass:"q-gutter-sm"},[e("q-btn-toggle",{staticClass:"my-custom-toggle",attrs:{"no-caps":"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"塗卡",value:"0"},{label:"數字",value:"1"}]},model:{value:t.qtyType,callback:function(e){t.qtyType=e},expression:"qtyType"}}),e("q-checkbox",{attrs:{label:"大小"},model:{value:t.isSize,callback:function(e){t.isSize=e},expression:"isSize"}}),e("q-checkbox",{attrs:{label:"品味"},model:{value:t.isTaste,callback:function(e){t.isTaste=e},expression:"isTaste"}})],1)])])]),0==t.qtyType?e("q-card-section",[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"q-pr-sm col-1"},[t._v("\n            份量:\n          ")]),e("div",{staticClass:"col"},[e("q-btn-toggle",{attrs:{"toggle-color":"primary",push:"",glossy:"",options:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"}]},model:{value:t.qty,callback:function(e){t.qty=e},expression:"qty"}})],1)])]):t._e(),t.isSize?e("q-card-section",{staticClass:"q-pt-sm"},[e("div",{staticClass:"row items-center"},[e("div",{staticClass:"col-1 q-pr-sm"},[t._v("\n            大小:\n          ")]),e("div",{staticClass:"col-4"},[e("q-badge",[t._v("\n              寬: "+t._s(t.width)+" %(20 to 70)\n            ")]),e("q-slider",{staticClass:"slider q-pa-none",attrs:{markers:"",snap:"",step:10,min:20,max:70},model:{value:t.width,callback:function(e){t.width=e},expression:"width"}})],1),e("div",{staticClass:"col-4"},[e("q-badge",[t._v("\n              高: "+t._s(t.height)+" %(20 to 60)\n            ")]),e("q-slider",{staticClass:"slider q-pa-none",attrs:{markers:"",snap:"",step:10,min:20,max:60},model:{value:t.height,callback:function(e){t.height=e},expression:"height"}})],1),e("div",{staticClass:"col"},[e("div",{staticClass:"row"},[e("p",{staticClass:"col-auto text-grey-9",staticStyle:{"font-size":"14px"}},[t._v("預覽：")]),e("div",{staticClass:"col-auto q-ml-sm",staticStyle:{border:"1px solid #4e4e4e",height:"36px",width:"50px"}},[e("div",{staticClass:"row items-center justify-center",staticStyle:{height:"100%"}},[e("q-btn",{style:{width:t.width+"%",height:t.height+"%"},attrs:{outline:"",color:"primary"}})],1)]),e("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[e("div",{staticClass:"text-body2"},[t._v("表格欄位裡的塗卡大小。")])])],1)])])]):t._e(),t.isTaste?e("q-card-section",[e("div",{staticClass:"q-my-xs"},[t._v("品味:")]),e("div",{staticClass:"row"},[e("div",[e("q-badge",{staticClass:"col q-mx-xs",staticStyle:{"font-size":"15px"},attrs:{color:t.groupsWithTastes[0].items.length>t.maxTastes?"red":"green"}},[t._v("\n              已選擇 ( "+t._s(t.groupsWithTastes[0].items.length)+" / "+t._s(t.maxTastes)+")\n            ")])],1)]),e("div",{directives:[{name:"drag-and-drop",rawName:"v-drag-and-drop",value:t.options,expression:"options"}],staticClass:"row q-mt-sm"},t._l(t.groupsWithTastes,(function(s){return e("q-card",{key:s.id,staticClass:"col q-mx-xs q-xy-sm",attrs:{id:s.id}},[e("q-list",{staticClass:"app-custom-list",staticStyle:{height:"100%"},attrs:{bordered:"",separator:"","data-id":s.id},on:{added:function(e){return t.added(e,s)},removed:function(e){return t.removed(e,s)},reordered:function(e){return t.reordered(e,s)}}},t._l(s.items,(function(s){return e("q-item",{key:s.id,staticClass:"app-item q-px-none",attrs:{"data-id":s.taste_no}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{staticClass:"q-mx-sm text-grey-9",attrs:{name:"menu"}})],1),e("q-item-section",{staticClass:"q-mx-sm text-grey-9"},[t._v(t._s(s.taste_name))])],1)})),1)],1)})),1)]):t._e(),e("q-card-section",[e("div",{staticClass:"q-my-xs"},[t._v("菜單:")]),e("div",{staticClass:"row"},[e("div",[e("q-badge",{staticClass:"col q-mx-xs",staticStyle:{"font-size":"15px"},attrs:{color:t.groupsWithOrders[0].items.length>t.maxOrders||0==t.groupsWithOrders[0].items.length?"red":"green"}},[t._v("\n              已選擇 ( "+t._s(t.groupsWithOrders[0].items.length)+" / "+t._s(t.maxOrders)+")\n            ")])],1)]),e("div",{directives:[{name:"drag-and-drop",rawName:"v-drag-and-drop",value:t.options,expression:"options"}],staticClass:"row"},t._l(t.groupsWithOrders,(function(s){return e("q-card",{key:s.id,staticClass:"col q-mx-xs q-xy-sm",attrs:{id:s.id}},[e("q-list",{staticClass:"app-custom-list",staticStyle:{height:"100%"},attrs:{bordered:"",separator:"","data-id":s.id},on:{added:function(e){return t.add2(e,s)},removed:function(e){return t.remove2(e,s)},reordered:function(e){return t.reordere2(e,s)}}},t._l(s.items,(function(i){return e("q-item",{key:i.id,staticClass:"app-item q-px-none",attrs:{"data-id":i.goods_no}},[e("q-item-section",{attrs:{avatar:""}},[e("q-icon",{staticClass:"col-1 q-mx-sm text-grey-9",attrs:{name:"menu"}})],1),e("q-item-section",{staticClass:"col-1 text-start text-red-8"},[t._v(t._s(i.category_name))]),"order_show"==s.id?e("q-item-section",{staticClass:"col-3 text-start text-grey-9"},[t._v("\n                  "+t._s(i.goods_name))]):e("q-item-section",{staticClass:"col text-left text-grey-9"},[t._v(t._s(i.goods_name))]),e("q-item-section",{staticClass:"col-2 text-grey-8 text-italic"},[t._v("NT$"+t._s(i.sale_price))]),"order_show"==s.id?e("q-item-section",{staticClass:"col q-mr-sm text-right"},[t.groupsWithTastes[0].items.length>0?e("div",{staticClass:"q-gutter-sm"},[t._v("\n                    "+t._s(i.taste)+"\n                    "),t._l(t.groupsWithTastes[0].items,(function(s){return e("q-checkbox",{key:s.id,attrs:{size:"xs",label:s.taste_name,val:s.taste_no,disable:""},model:{value:i.showTaste,callback:function(e){t.$set(i,"showTaste",e)},expression:"item.showTaste"}})}))],2):t._e()]):t._e()],1)})),1)],1)})),1)]),e("div",{staticClass:"row justify-end q-mt-sm"},[e("q-btn",{staticClass:"mr-20",attrs:{size:"16px",color:"negative",label:"返回"},on:{click:function(e){return t.$router.push({name:"main"})}}}),e("q-btn",{staticClass:"mr-20",attrs:{size:"16px",color:"primary",label:"製作菜單"},on:{click:t.makeMenu}})],1)],1)],1),e("ErrorMsg",{attrs:{err:t.msgObj.isError,num:t.msgObj.num,msg:t.msgObj.errormsg},on:{returnOk:t.get_error}})],1)},r=[],a=(s("ddb0"),s("e7fc"),s("a639"),s("beb3")),o={name:"Processing",components:{ErrorMsg:a["a"]},data(){return{menuObj:{},menuString:"",isSize:!0,isTaste:!0,qtyType:0,qty:0,width:20,height:20,maxTastes:3,maxOrders:60,pageMaxOrders:20,columns:[{name:"name",required:!0,label:"Dessert (100g serving)",align:"left",field:t=>t.name,format:t=>`${t}`,sortable:!0},{name:"calories",align:"center",label:"Calories",field:"calories",sortable:!0},{name:"fat",label:"Fat (g)",field:"fat",sortable:!0},{name:"carbs",label:"Carbs (g)",field:"carbs"},{name:"protein",label:"Protein (g)",field:"protein"},{name:"sodium",label:"Sodium (mg)",field:"sodium"},{name:"calcium",label:"Calcium (%)",field:"calcium",sortable:!0,sort:(t,e)=>parseInt(t,10)-parseInt(e,10)},{name:"iron",label:"Iron (%)",field:"iron",sortable:!0,sort:(t,e)=>parseInt(t,10)-parseInt(e,10)}],groupsWithTastes:[{id:"taste_show",items:[]},{id:"taste_hidden",items:[]}],groupsWithOrders:[{id:"order_show",items:[]},{id:"order_hidden",items:[]}],options:{multipleDropzonesItemsDraggingEnabled:!1,dropzoneSelector:".q-list",draggableSelector:".q-item"},json_file:null,logo_b64string:"",msgObj:{isSuccess:!1,isError:!1,num:0,errormsg:"",successmsg:""}}},created(){this.init(),this.subscribe_topic="menu/#",this.$mqtt.subscribe(this.subscribe_topic),this.$mqtt.publish("menu/from_page/get_menu","get_menu")},mqtt:{"menu/#"(t,e){"menu/from_server/get_menu"===e&&(this.get_settings=JSON.parse(t),this.menu=this.get_settings.menu,this.tastes=this.get_settings.tastes,console.log("this.get_settings",this.get_settings),this.initMenu())}},mounted(){console.log("make menu mounted")},computed:{CanMake:function(){return(this.groupsWithTastes[0].items.length<=this.maxTastes||!this.isTaste)&&this.groupsWithOrders[0].items.length<=this.maxOrders&&0<this.groupsWithOrders[0].items.length},TasteHeight:function(){let t=this.groupsWithTastes[0].items.length>0?this.groupsWithTastes[0].items.length:0,e=this.groupsWithTastes[1].items.length?this.groupsWithTastes[1].items.length:0;return t>e?70*t:70*e},OrderHeight:function(){let t=this.groupsWithOrders[0].items.length>0?this.groupsWithOrders[0].items.length:0,e=this.groupsWithOrders[1].items.length?this.groupsWithOrders[1].items.length:0;return t>e?70*t:70*e}},watch:{qtyType(){"1"==this.qtyType?this.qty="1":this.qty=this.qty}},methods:{init(){this.qty="2",this.qtyType="0"},initMenu(){this.groupsWithTastes[0].items=JSON.parse(JSON.stringify(this.tastes)),this.menu.forEach((t=>{t.showTaste=[],t.ori_taste.forEach((e=>{t.showTaste.push(e.taste_no)}))})),this.groupsWithOrders[0].items=JSON.parse(JSON.stringify(this.menu))},added(t,e){this.json_file&&this.rmUploadFile();const s=this.groupsWithTastes.map((t=>t.items)).reduce(((t,e)=>[...t,...e]),[]).filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.taste_no))>=0));e.items.splice(t.detail.index,0,...s)},removed(t,e){e.items=e.items.filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.taste_no))<0))},reordered(t,e){const s=e.items.filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.taste_no))>=0)),i=e.items.filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.taste_no))<0));i.splice(t.detail.index,0,...s),e.items=i},add2(t,e){this.json_file&&this.rmUploadFile();const s=this.groupsWithOrders.map((t=>t.items)).reduce(((t,e)=>[...t,...e]),[]).filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.goods_no))>=0));if(e.items.splice(t.detail.index,0,...s),"order_hidden"==t.target.getAttribute("data-id")){t.detail.items[0]}},remove2(t,e){e.items=e.items.filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.goods_no))<0))},reordere2(t,e){const s=e.items.filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.goods_no))>=0)),i=e.items.filter((e=>t.detail.ids.map(Number).indexOf(parseInt(e.goods_no))<0));i.splice(t.detail.index,0,...s),e.items=i},makeMenu(){if(this.menuObj.setting={},this.menuObj.qty=this.qty,this.logo_b64string?this.menuObj.b64img=this.logo_b64string:this.menuObj.b64img="",this.isSize&&(this.menuObj.boxSize={},this.menuObj.boxSize.width=this.width,this.menuObj.boxSize.height=this.height),this.isTaste&&(this.menuObj.taste=this.groupsWithTastes[0].items,this.menuObj.noTaste=this.groupsWithTastes[1].items),this.menuObj.menu1=[],this.menuObj.menu2=[],this.menuObj.noMenu=this.groupsWithOrders[1].items,this.menuObj.setting.qtyType=this.qtyType,this.menuObj.setting.isSize=this.isSize,this.menuObj.setting.isTaste=this.isTaste,this.isTaste&&this.groupsWithOrders[0].items.forEach((t=>{t.realtaste=[],this.menuObj.taste.forEach((e=>{t.ori_taste.forEach((s=>{s.taste_no==e.taste_no&&t.realtaste.push(s)}))}))})),this.groupsWithOrders[0].items.length<=this.pageMaxOrders)this.menuObj.menu1=this.groupsWithOrders[0].items;else{let t=this.groupsWithOrders[0].items.length,e=t%2==0&&t/2<=this.maxOrders/2?t/2:parseInt(t/2)+1;for(let s=0;s<e;s++)this.menuObj.menu1.push(this.groupsWithOrders[0].items[s]);for(let s=e;s<t;s++)this.menuObj.menu2.push(this.groupsWithOrders[0].items[s])}this.menuString=JSON.stringify(this.menuObj),sessionStorage.setItem("menuFormat",this.menuString),this.$router.push({path:"preview"})},confirmFile(t){let e=["json"],s=t.split(".").pop().toLowerCase();return-1!==e.indexOf(s)||(alert("放入資料格式錯誤！"),!1)},upLoadFile(t){let e=this;if(!e.confirmFile(t.name))return;let s=new FileReader;s.readAsText(t,"utf-8"),s.onload=function(){let t=JSON.parse(s.result);if("undefined"===typeof t.qty)return e.json_file=null,void e.errorMethod(5);e.qtyType=t.setting.qtyType,e.isSize=t.setting.isSize,e.isTaste=t.setting.isTaste,e.qty=t.qty,""!=t.b64img&&(e.logo_b64string=t.b64img),e.isSize&&(e.width=t.boxSize.width,e.height=t.boxSize.height),e.isTaste&&(e.groupsWithTastes[0].items=t.taste,e.groupsWithTastes[1].items=t.noTaste),e.groupsWithOrders[0].items=JSON.parse(JSON.stringify(t.menu1)),0!=t.menu2.length&&t.menu2.forEach((t=>{e.groupsWithOrders[0].items.push(t)})),e.groupsWithOrders[1].items=t.noMenu}},upLoadImage(t){let e=new FileReader,s=this;e.readAsDataURL(t),e.onload=function(){let t;t=e.result,s.logo_b64string=t}},rmUploadFile(){this.json_file=null},rmUploadImg(){this.logo_b64string="",this.json_file&&this.rmUploadFile()},errorMethod(t,e){this.msgObj.isError=!0,this.msgObj.num=t,this.msgObj.errormsg=e},get_error(t){this.msgObj.isError=t}},beforeDestroy(){}},n=o,l=(s("135f"),s("2877")),c=s("9989"),d=s("f09f"),m=s("a370"),u=s("7d53"),h=s("0016"),p=s("6a67"),g=s("8f8e"),b=s("58a8"),f=s("c1d0"),_=s("9c40"),q=s("05c0"),x=s("1c1c"),v=s("66e5"),y=s("4074"),O=s("eaac"),C=s("eebe"),T=s.n(C),w=Object(l["a"])(n,i,r,!1,null,"13787b7a",null);e["default"]=w.exports;T()(w,"components",{QPage:c["a"],QCard:d["a"],QCardSection:m["a"],QFile:u["a"],QIcon:h["a"],QBtnToggle:p["a"],QCheckbox:g["a"],QBadge:b["a"],QSlider:f["a"],QBtn:_["a"],QTooltip:q["a"],QList:x["a"],QItem:v["a"],QItemSection:y["a"],QTable:O["a"]})},6:function(t,e){},7:function(t,e){},8:function(t,e){},9:function(t,e){},b3f5:function(t,e,s){},beb3:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("q-dialog",{model:{value:t.isError,callback:function(e){t.isError=e},expression:"isError"}},[e("q-card",{staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row items-center bg-red-8 text-grey-3"},[e("div",{staticClass:"text-h6"},[t._v("Error")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:t.closeBtn}})],1),e("q-card-section",{staticClass:"text-grey-9 text-center"},[e("q-icon",{staticClass:"q-pt-lg",staticStyle:{"font-size":"80px"},attrs:{name:"error_outline"}}),e("div",{staticStyle:{"font-size":"26px","line-height":"50px"},attrs:{id:"errorMessage"}},[t._v("\n                "+t._s(t.errorText)+"\n            ")])],1),e("q-card-actions",{staticClass:"bg-white",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK"},on:{click:t.closeBtn}})],1)],1)],1)},r=[],a={name:"errorMsg",props:{err:Boolean,num:Number,msg:String},data(){return{isError:null,isSuccess:null,errorText:""}},watch:{err(){this.isError=this.err,this.errorMethod(this.num,this.msg)}},methods:{errorMethod(t,e){switch(t){case 1:this.errorText="Timeout(1)";break;case 2:this.errorText="System error(2)";break;case 3:this.errorText="Can't find camera(3)";break;case 4:this.errorText="Web api error(4)";break;case 5:this.errorText="Data error(5)";break;case 6:this.errorText="Setting data not ready(6)";break;case 7:this.errorText="The detected area must be within 2(7)";break;case 8:this.errorText="Format error(8)";break;case 99:this.errorText=e+"(99)";break;default:this.errorText="Operation error(0)";break}},closeBtn(){this.$emit("returnOk",!1)}}},o=a,n=s("2877"),l=s("24e8"),c=s("f09f"),d=s("a370"),m=s("2c91"),u=s("9c40"),h=s("0016"),p=s("4b7e"),g=s("7f67"),b=s("eebe"),f=s.n(b),_=Object(n["a"])(o,i,r,!1,null,null,null);e["a"]=_.exports;f()(_,"components",{QDialog:l["a"],QCard:c["a"],QCardSection:d["a"],QSpace:m["a"],QBtn:u["a"],QIcon:h["a"],QCardActions:p["a"]}),f()(_,"directives",{ClosePopup:g["a"]})}}]);
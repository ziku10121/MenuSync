(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{1:function(t,e){},10:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},6:function(t,e){},6824:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("q-page",[e("div",{staticClass:"column items-center py-30"},[e("q-card",{staticClass:"my-card q-pa-md",attrs:{flat:"",bordered:""}},[e("div",{staticClass:"wrap"},[e("div",{staticClass:"q-mt-xl"},[e("div",{staticClass:"row justify-center"},[e("div",{staticClass:"video"},[e("img",{attrs:{src:t.imgSrc,width:"1080",height:"768"}}),t.streaming?e("div",{staticClass:"caption live"},[e("b",[t._v("LIVE")])]):t._e()]),e("div",{staticClass:"col-12 text-center"},[t._v("\n                            "+t._s(t.imgName)+"\n                        ")])]),e("div",{staticClass:"row items-center justify-center q-mt-lg"},[e("div",{staticClass:"col-auto"},[t.streaming?t._e():e("q-btn",{staticClass:"q-mx-md",attrs:{round:"",color:"primary"},on:{click:function(e){t.startLive(),t.showBack=!1}}},[e("q-icon",{attrs:{name:"reply"}}),e("q-tooltip",{model:{value:t.showBack,callback:function(e){t.showBack=e},expression:"showBack"}},[t._v("返回")])],1),e("q-btn",{staticClass:"q-mx-md",attrs:{round:"",color:"primary",disabled:!t.streaming},on:{click:function(e){return t.capture()}}},[e("q-icon",{attrs:{name:"screenshot_monitor"}}),e("q-tooltip",{model:{value:t.showCap,callback:function(e){t.showCap=e},expression:"showCap"}},[t._v("截圖")])],1)],1)]),e("div",{staticClass:"row justify-end"},[e("div",{staticClass:"col-auto"},[e("q-btn",{attrs:{color:"primary",label:"確認",disabled:t.streaming},on:{click:function(e){return t.postSetup("confirm")}}})],1)])])]),e("q-dialog",{attrs:{persistent:""},model:{value:t.isUpload,callback:function(e){t.isUpload=e},expression:"isUpload"}},[e("q-card",{staticStyle:{width:"450px"}},[e("q-card-section",{staticClass:"row between bg-primary text-grey-3"},[e("div",{staticClass:"col text-h6"},[t._v("Menu File")]),e("q-icon",{staticStyle:{"font-size":"2rem",cursor:"pointer"},attrs:{name:"help_outline"}},[e("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle","content-style":"font-size: 16px"}},[t._v("\n                                Please put the menu JSON data."),e("br"),t._v("\n                                The cancel button is to make the menu page, and the OK button is to get the menu JSON data.\n                            ")])],1),e("q-space")],1),e("q-card-section",{staticClass:"body q-py-xl"},[e("div",{staticClass:"column items-center"},[e("div",{staticClass:"col"},[e("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"upfile",accept:".json"},on:{change:t.upLoadFile}}),e("button",{staticClass:"upload_btn",attrs:{id:"button",onclick:"document.getElementById('upfile').click()"}},[e("div",{staticClass:"column items-center"},[t.json_file?t._e():e("q-icon",{staticClass:"upload_icon",attrs:{name:"o_file_upload"}}),t.json_file?e("q-icon",{staticClass:"upload_icon",staticStyle:{color:"black",position:"relative"},attrs:{name:"o_insert_drive_file"}},[e("span",[t._v("JSON")]),e("q-icon",{attrs:{name:"cancel"},on:{click:function(e){return t.rmFile(e)}}})],1):e("label",{staticStyle:{"font-size":"14px","font-weight":"700"}},[t._v("Upload")])],1)])]),t.json_file?e("div",{staticClass:"col"},[t._v("\n                                "+t._s(t.json_file.name)+"\n                            ")]):t._e()])]),e("q-card-actions",{staticClass:"bg-white q-pb-md q-pr-md",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"cancel"},on:{click:function(e){return t.$router.push({path:"makeMenu"})}}}),e("q-btn",{attrs:{label:"ok"},on:{click:t.saveStorage}})],1)],1)],1),e("errorMsg",{attrs:{err:t.msgObj.isError,num:t.msgObj.num,msg:t.msgObj.errormsg},on:{returnOk:t.get_error}}),e("successMsg",{attrs:{success:t.msgObj.isSuccess,msg:t.msgObj.successmsg},on:{returnOk:t.get_success}})],1)],1)])},a=[],r=s("f5084"),o=s("0d59"),n=(s("a639"),s("5118"),s("ac5e")),c=(s("e7fc"),s("beb3")),l=s("b74d"),u={name:"Capture",components:{errorMsg:c["a"],successMsg:l["a"]},data(){return{streaming:!1,loadtimer:null,loadingdelay:15,bgkey:"",timer:null,isUpload:!1,json_file:null,menu_data:null,get_img:null,imgSrc:null,imgName:null,tempImg:null,msgObj:{isSuccess:!1,isError:!1,num:0,errormsg:"",successmsg:""},setupUrl:"",showBack:!1,showCap:!1}},created(){this.subscribe_topic="menu/#",this.$mqtt.subscribe(this.subscribe_topic),console.log("subscribe(menu/#)"),sessionStorage.removeItem("detect");let t=sessionStorage.getItem("menuFormat");void 0!=t&&null!=t&&""!=t||(this.isUpload=!0),this.setupUrl=n["a"],this.menu_data=JSON.parse(t),console.log("api:",this.setupUrl),console.log("capture menu data:",this.menu_data)},mqtt:{"menu/#"(t,e){"menu/from_server/start"===e&&(this.get_img=JSON.parse(t),this.streaming&&(this.imgSrc=this.get_img.img_url,this.imgName=this.get_img.img_name))}},mounted(){let t=this;t.menu_data&&t.startLive(),window.addEventListener("keydown",(function(e){""==t.bgkey&&t.openKey(5),e.keyCode>=65&&e.keyCode<=90&&(t.bgkey+=e.key),"Enter"==e.key&&("stoplive"===t.bgkey&&1==t.streaming&&t.stopLive(),"startlive"===t.bgkey&&0==t.streaming&&t.startLive(),t.clearKey())}),!1)},methods:{init(){},confirmFile(t){if(null==t)return!1;let e=["json"],s=t.name,i=s.split(".").pop().toLowerCase();return-1!==e.indexOf(i)},upLoadFile(){let t=document.getElementById("upfile");this.json_file=t.files[0]},rmFile(t){t.stopPropagation(),document.getElementById("upfile").value="",this.json_file=null,this.menu_data=null},saveStorage(){let t=this;if(!t.confirmFile(t.json_file))return t.json_file=null,void t.errorMethod(8);let e=new FileReader;e.readAsText(t.json_file,"utf-8"),e.onload=function(){let s=JSON.parse(e.result);if("undefined"===typeof s.qty)return t.json_file=null,void t.errorMethod(5);t.isUpload=!1,t.successMethod("Upload"),t.menu_data=JSON.stringify(s),sessionStorage.setItem("menuFormat",t.menu_data),t.startLive(),console.log("capture menu data:",t.menu_data)}},startLive(){this.streaming=!0,this.postSetup("start")},stopLive(){this.streaming=!1,this.postSetup("stop")},detectLive(){this.streaming=!1,this.postSetup("detect")},capture(){this.streaming&&(this.stopLive(),this.showCap=!1),this.tempPhoto()},tempPhoto(){this.tempImg=this.get_img,this.imgSrc=this.tempImg.img_url,this.imgName=this.tempImg.img_name},postSetup(t){let e=this,s={command:"",img_name:""};s.command=t,"confirm"==t&&(s.img_name=e.tempImg.img_name),fetch(e.setupUrl,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((t=>t.json())).catch((t=>{console.error("Error:",t),e.errorMethod(4)})).then((function(t){if("ok"==t.status){if("confirm"==t.command){let s={url:"",name:""};s.url=t.img_url,s.name=t.img_name,e.hideLoading(),e.goDetect(s)}}else e.hideLoading(),e.errorMethod(5)}))},showLoading(){this.show({spinner:o["a"],spinnerSize:140,message:"照片上傳中，請稍等..."})},show(t){let e=this;r["a"].show(t),e.loadtimer=setTimeout((()=>{e.errorMethod(1),r["a"].hide(),e.loadtimer=null,e.startLive()}),1e3*e.loadingdelay)},hideLoading(){let t=this;r["a"].hide(),window.clearTimeout(t.loadtimer),t.loadtimer=null},errorMethod(t,e){this.msgObj.isError=!0,this.msgObj.num=t,this.msgObj.errormsg=e},successMethod(t){this.msgObj.isSuccess=!0,this.msgObj.successmsg=t},get_error(t){this.msgObj.isError=t},get_success(t){this.msgObj.isSuccess=t},goDetect(t){this.$router.push({path:"detect",query:t})},openKey(t){let e=this;this.timer=setTimeout((function(){e.clearKey()}),1e3*t)},clearKey(){this.bgkey="",null!=this.timer&&window.clearTimeout(this.timer)}}},m=u,d=(s("6de4"),s("2877")),p=s("9989"),h=s("f09f"),g=s("9c40"),f=s("0016"),b=s("05c0"),v=s("24e8"),_=s("a370"),y=s("2c91"),C=s("4b7e"),S=s("7f67"),k=s("eebe"),q=s.n(k),w=Object(d["a"])(m,i,a,!1,null,"9a6b3f7c",null);e["default"]=w.exports;q()(w,"components",{QPage:p["a"],QCard:h["a"],QBtn:g["a"],QIcon:f["a"],QTooltip:b["a"],QDialog:v["a"],QCardSection:_["a"],QSpace:y["a"],QCardActions:C["a"]}),q()(w,"directives",{ClosePopup:S["a"]})},"6de4":function(t,e,s){"use strict";s("f087")},7:function(t,e){},8:function(t,e){},9:function(t,e){},b74d:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("q-dialog",{model:{value:t.isSuccess,callback:function(e){t.isSuccess=e},expression:"isSuccess"}},[e("q-card",{staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row items-center bg-green-8 text-grey-3"},[e("div",{staticClass:"text-h6"},[t._v(t._s(t.successText))]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:t.closeBtn}})],1),e("q-card-section",{staticClass:"text-grey-9 text-center"},[e("q-icon",{staticClass:"q-pt-lg",staticStyle:{"font-size":"80px"},attrs:{name:"o_check_circle"}}),e("div",{staticStyle:{"font-size":"28px","line-height":"50px"}},[t._v("\n                "+t._s(t.successText)+" Success!\n            ")])],1),e("q-card-actions",{staticClass:"bg-white",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK"},on:{click:t.closeBtn}})],1)],1)],1)},a=[],r={name:"errorMsg",props:{success:Boolean,msg:String},data(){return{isSuccess:null,successText:""}},watch:{success(){this.isSuccess=this.success,this.successText=this.msg}},mounted(){},methods:{closeBtn(){this.$emit("returnOk",!1)}}},o=r,n=s("2877"),c=s("24e8"),l=s("f09f"),u=s("a370"),m=s("2c91"),d=s("9c40"),p=s("0016"),h=s("4b7e"),g=s("7f67"),f=s("eebe"),b=s.n(f),v=Object(n["a"])(o,i,a,!1,null,null,null);e["a"]=v.exports;b()(v,"components",{QDialog:c["a"],QCard:l["a"],QCardSection:u["a"],QSpace:m["a"],QBtn:d["a"],QIcon:p["a"],QCardActions:h["a"]}),b()(v,"directives",{ClosePopup:g["a"]})},beb3:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return e("q-dialog",{model:{value:t.isError,callback:function(e){t.isError=e},expression:"isError"}},[e("q-card",{staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row items-center bg-red-8 text-grey-3"},[e("div",{staticClass:"text-h6"},[t._v("Error")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:t.closeBtn}})],1),e("q-card-section",{staticClass:"text-grey-9 text-center"},[e("q-icon",{staticClass:"q-pt-lg",staticStyle:{"font-size":"80px"},attrs:{name:"error_outline"}}),e("div",{staticStyle:{"font-size":"26px","line-height":"50px"},attrs:{id:"errorMessage"}},[t._v("\n                "+t._s(t.errorText)+"\n            ")])],1),e("q-card-actions",{staticClass:"bg-white",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK"},on:{click:t.closeBtn}})],1)],1)],1)},a=[],r={name:"errorMsg",props:{err:Boolean,num:Number,msg:String},data(){return{isError:null,isSuccess:null,errorText:""}},watch:{err(){this.isError=this.err,this.errorMethod(this.num,this.msg)}},methods:{errorMethod(t,e){switch(t){case 1:this.errorText="Timeout(1)";break;case 2:this.errorText="System error(2)";break;case 3:this.errorText="Can't find camera(3)";break;case 4:this.errorText="Web api error(4)";break;case 5:this.errorText="Data error(5)";break;case 6:this.errorText="Setting data not ready(6)";break;case 7:this.errorText="The detected area must be within 2(7)";break;case 8:this.errorText="Format error(8)";break;case 99:this.errorText=e+"(99)";break;default:this.errorText="Operation error(0)";break}},closeBtn(){this.$emit("returnOk",!1)}}},o=r,n=s("2877"),c=s("24e8"),l=s("f09f"),u=s("a370"),m=s("2c91"),d=s("9c40"),p=s("0016"),h=s("4b7e"),g=s("7f67"),f=s("eebe"),b=s.n(f),v=Object(n["a"])(o,i,a,!1,null,null,null);e["a"]=v.exports;b()(v,"components",{QDialog:c["a"],QCard:l["a"],QCardSection:u["a"],QSpace:m["a"],QBtn:d["a"],QIcon:p["a"],QCardActions:h["a"]}),b()(v,"directives",{ClosePopup:g["a"]})},f087:function(t,e,s){}}]);
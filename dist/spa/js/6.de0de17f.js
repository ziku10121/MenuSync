(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"18dc":function(t,e,s){"use strict";s("8c24")},"8c24":function(t,e,s){},beb3:function(t,e,s){"use strict";var r=function(){var t=this,e=t._self._c;return e("q-dialog",{model:{value:t.isError,callback:function(e){t.isError=e},expression:"isError"}},[e("q-card",{staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row items-center bg-red-8 text-grey-3"},[e("div",{staticClass:"text-h6"},[t._v("Error")]),e("q-space"),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:t.closeBtn}})],1),e("q-card-section",{staticClass:"text-grey-9 text-center"},[e("q-icon",{staticClass:"q-pt-lg",staticStyle:{"font-size":"80px"},attrs:{name:"error_outline"}}),e("div",{staticStyle:{"font-size":"26px","line-height":"50px"},attrs:{id:"errorMessage"}},[t._v("\n                "+t._s(t.errorText)+"\n            ")])],1),e("q-card-actions",{staticClass:"bg-white",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"OK"},on:{click:t.closeBtn}})],1)],1)],1)},i=[],o={name:"errorMsg",props:{err:Boolean,num:Number,msg:String},data(){return{isError:null,isSuccess:null,errorText:""}},watch:{err(){this.isError=this.err,this.errorMethod(this.num,this.msg)}},methods:{errorMethod(t,e){switch(t){case 1:this.errorText="Timeout(1)";break;case 2:this.errorText="System error(2)";break;case 3:this.errorText="Can't find camera(3)";break;case 4:this.errorText="Web api error(4)";break;case 5:this.errorText="Data error(5)";break;case 6:this.errorText="Setting data not ready(6)";break;case 7:this.errorText="The detected area must be within 2(7)";break;case 8:this.errorText="Format error(8)";break;case 99:this.errorText=e+"(99)";break;default:this.errorText="Operation error(0)";break}},closeBtn(){this.$emit("returnOk",!1)}}},a=o,l=s("2877"),n=s("24e8"),c=s("f09f"),h=s("a370"),d=s("2c91"),u=s("9c40"),p=s("0016"),m=s("4b7e"),g=s("7f67"),y=s("eebe"),b=s.n(y),f=Object(l["a"])(a,r,i,!1,null,null,null);e["a"]=f.exports;b()(f,"components",{QDialog:n["a"],QCard:c["a"],QCardSection:h["a"],QSpace:d["a"],QBtn:u["a"],QIcon:p["a"],QCardActions:m["a"]}),b()(f,"directives",{ClosePopup:g["a"]})},f05f:function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t._self._c;return e("q-page",[e("div",{staticClass:"column items-center py-30"},[e("q-card",{staticClass:"my-card q-pa-md",attrs:{flat:"",bordered:""}},[e("div",{staticClass:"wrap"},[e("div",{staticClass:"column items-center"},[e("div",{staticClass:"col"},[e("div",[e("div",{staticClass:"row q-pt-sm"},[e("div",{staticClass:"col-6"},[e("div",{staticClass:"row q-px-md q-mt-md items-center"},[e("div",{staticClass:"col-auto q-pr-md"},[e("div",{staticClass:"title"},[t._v("格數設定"),e("small",[t._v("(系統帶入)")])])]),e("div",{staticClass:"col-auto"},[e("q-btn",{attrs:{flat:"",round:""},on:{click:function(e){t.isHelp=!0}}},[e("q-tooltip",{attrs:{anchor:"top right",self:"top middle"}},[t._v("\n                          幫助!\n                        ")]),e("q-icon",{staticClass:"text-dark",staticStyle:{"font-size":"2rem"},attrs:{name:"help_outline"}})],1)],1)])])]),e("div",{staticClass:"row q-mb-md items-center"},[e("div",{staticClass:"col-2 q-px-md"},[e("q-input",{attrs:{outlined:"",type:"number",label:"種類選項",disable:"",readonly:""},model:{value:t.typeNum,callback:function(e){t.typeNum=e},expression:"typeNum"}})],1),e("div",{staticClass:"col-2 q-pr-md"},[e("q-input",{attrs:{outlined:"",type:"number",label:"左圖總筆數",disable:"",readonly:""},model:{value:t.leftNum,callback:function(e){t.leftNum=e},expression:"leftNum"}})],1),e("div",{staticClass:"col-2 q-pr-md"},[e("q-input",{attrs:{outlined:"",type:"number",label:"右圖總筆數",disable:"",readonly:""},model:{value:t.rightNum,callback:function(e){t.rightNum=e},expression:"rightNum"}})],1),e("div",{staticClass:"col"},[e("div",{staticClass:"row q-pa-md items-center"},[e("div",{staticClass:"col-auto"},[e("q-btn",{staticClass:"q-mr-md",attrs:{size:"18px",color:"blue-8",disabled:!t.isResetShow},on:{click:t.reset}},[e("div",[t._v("重設標示")])])],1)])])])]),e("div",[e("div",{staticClass:"row items-end"},[e("div",{staticClass:"col-auto"},[e("div",{staticClass:"annotator"},[e("v-annotator",{attrs:{drawing:t.drawing,inertia:t.inertia,minSize:t.minSize,grid:t.grid},on:{select:t.selectRect}},[e("img",{attrs:{id:"image",draggable:"false",src:t.imgSrc}}),t._l(t.offsetList,(function(t,s){return e("rect",{key:s,staticClass:"rect stroke",attrs:{slot:"annotation",x:t.x,y:t.y,width:"175",height:"100"},slot:"annotation"})}))],2),e("div",{staticClass:"detect1"},t._l(t.leftNum*t.typeNum,(function(t){return e("div",{key:t,staticClass:"item"})})),0),e("div",{staticClass:"detect2"},t._l(t.leftNum*t.typeNum,(function(t){return e("div",{key:t,staticClass:"item"})})),0)],1)]),e("div",{staticClass:"col q-pl-md pb-10"},[t.isDetect?e("q-btn",{staticStyle:{width:"105px",height:"65px"},attrs:{color:"blue-8",size:"18px",disabled:!t.isDetectShow},on:{click:t.doPreview}},[t._v("偵測")]):t._e(),t.isSendData?e("q-btn",{staticStyle:{width:"105px",height:"65px"},attrs:{color:"blue-8",size:"18px",disabled:!t.isSendDataShow},on:{click:t.doInfo}},[t._v("資料傳送"+t._s(t.time))]):t._e()],1)])])])]),e("q-dialog",{model:{value:t.isHelp,callback:function(e){t.isHelp=e},expression:"isHelp"}},[e("q-card",{staticClass:"bg-dark text-white",staticStyle:{width:"700px","max-width":"80vw"}},[e("q-card-section",{staticClass:"row items-center"},[e("q-icon",{staticClass:"text-white q-mr-sm",staticStyle:{"font-size":"2rem"},attrs:{name:"help"}}),e("div",{staticClass:"text-h6"},[t._v("操作說明")])],1),e("q-card-section",{staticClass:"body q-pt-md bg-grey-1 text-dark"},[e("p",{staticClass:"text-body"},[e("strong",[t._v("Step1.")]),t._v("  讀取JSON檔案。")]),e("p",{staticClass:"text-body"},[e("strong",[t._v("Step2.")]),t._v("  在圖片中左鍵產生標示並選取需偵測範圍。")]),e("p",{staticClass:"text-body"},[e("strong",[t._v("Step3.")]),t._v("  確認圖片中已選取2個標示後，進行偵測。")]),e("p",{staticClass:"text-body"},[e("strong",[t._v("Step4.")]),t._v("  確認偵測內容，並進行資料傳送。")])]),e("q-card-actions",{staticClass:"bg-grey-1 text-dark",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"OK"}})],1)],1)],1),e("errorMsg",{attrs:{err:t.msgObj.isError,num:t.msgObj.num,msg:t.msgObj.errormsg},on:{returnOk:t.get_error}})],1)])],1)])},i=[],o=(s("ddb0"),s("9861"),s("ac5e")),a=s("bf83"),l=s.n(a),n={Dimensions:[],BubbleDimensions:[],Options:{},Concatenations:{},Singles:[],QBlocks:{MCQBlock1:{qType:"QTYPE_MCQ6",orig:[],qNos:[[]],gaps:[],bigGaps:[80,80]},MCQBlock2:{qType:"QTYPE_MCQ6",orig:[],qNos:[[]],gaps:[],bigGaps:[80,80]}}},c=n,h=s("beb3"),d={components:{"v-annotator":l.a,errorMsg:h["a"]},data(){return{menuJson:{},ori_margin:{},ori_tdSize:{},typeNum:"",leftNum:"",rightNum:"",file:null,selectObj:null,imgSrc:"",time:"",delaytime:3,drawing:!1,minSize:[20,20],grid:[0,0],inertia:!0,offsetList:[],left_boxWidth:0,left_boxHeight:0,right_boxWidth:0,right_boxHeight:0,isResetShow:!1,isDetect:!0,isDetectShow:!1,isSendData:!1,isSendDataShow:!1,isHelp:!0,msgObj:{isError:!1,num:0,errormsg:""},setupUrl:""}},mounted(){document.addEventListener("keydown",this.inputKeyDown,!1),document.addEventListener("mousedown",this.addRect,!1),document.addEventListener("mouseup",this.confirmRectNum,!1)},created(){this.setupUrl=o["a"],console.log("api:",this.setupUrl),this.getParam(),this.getMenuSetting(),this.reset()},methods:{getParam(){let t=window.location.search.substring(1);""==t&&this.$router.go(-1);let e=new URLSearchParams(t);this.imgSrc=e.get("url")},getMenuSetting(){let t=sessionStorage.getItem("menuFormat");void 0!=t&&null!=t&&""!=t||this.$router.push({path:"capture"}),this.menuJson=JSON.parse(t),this.typeNum=parseInt(this.menuJson.qty)+this.menuJson.taste.length,this.leftNum=this.menuJson.menu1.length,this.rightNum=this.menuJson.menu2.length,this.ori_margin=this.menuJson.margin,this.ori_tdSize=this.menuJson.tdSize,this.menuJsonProcess()},addRect(t){if("1"!=t.which||"IMG"!=t.target.nodeName||!this.isDetect)return;""!=this.typeNum&&""!=this.leftNum&&""!=this.rightNum||this.errorMethod(6);let e={};e.x=t.offsetX,e.y=t.offsetY,this.offsetList.push(e)},selectRect(t){this.selectObj=t.node},confirmRectNum(){let t=document.querySelector(".foreground"),e=0;null!=t&&(t.childNodes.forEach((t=>{"rect"==t.nodeName&&e++})),0!=e&&(this.isResetShow=!0),this.isDetectShow=2==e,e>2&&(this.removeRect("last"),this.errorMethod(7)))},reset(){this.removeRect("all"),this.confirmRectNum();const t=document.documentElement;t.style.setProperty("--left_xmargin","0px"),t.style.setProperty("--left_ymargin","0px"),t.style.setProperty("--right_xmargin","0px"),t.style.setProperty("--right_ymargin","0px"),t.style.setProperty("--left_BubbleWidth","20px"),t.style.setProperty("--left_BubbleHeight","20px"),t.style.setProperty("--right_BubbleWidth","20px"),t.style.setProperty("--right_BubbleHeight","20px"),t.style.setProperty("--left_x","0px"),t.style.setProperty("--left_y","0px"),t.style.setProperty("--right_x","0px"),t.style.setProperty("--right_y","0px"),t.style.setProperty("--left_width","0px"),t.style.setProperty("--left_height","0px"),t.style.setProperty("--right_width","0px"),t.style.setProperty("--right_height","0px"),this.isDetect=!0,this.isSendData=!1},inputKeyDown(t){if(46==t.keyCode){let t=null;if(null==this.selectObj||null==this.selectObj.parentNode)return;if(this.selectObj.parentNode.childNodes.forEach((e=>{"g"===e.nodeName&&(t=e)})),null==t)return;t.remove(),this.selectObj.remove()}},removeRect(t){let e=document.querySelector(".foreground");if(null!=e&&!(e.childNodes<1)&&("first"==t&&e.removeChild(e.firstChild),"last"==t&&e.removeChild(e.lastChild),"all"==t))while(e.firstChild)e.firstChild.remove()},doPreview(){const t=document.querySelectorAll(".rect");let e=[];t[0].x.baseVal.value<t[1].x.baseVal.value?(e.push(t[0]),e.push(t[1])):(e.push(t[1]),e.push(t[0]));for(let s=0;s<e.length;s++){const t=document.documentElement;let r=e[s].width.baseVal.value/this.typeNum,i=e[s].height.baseVal.value/this.leftNum,o=r/this.ori_tdSize.width*this.ori_margin.x,a=i/this.ori_tdSize.height*this.ori_margin.y,l=r-o,n=i-a;0==s?this.left_boxWidth=Math.round(100*r)/100:this.right_boxWidth=Math.round(100*r)/100,0==s?this.left_boxHeight=Math.round(100*i)/100:this.right_boxHeight=Math.round(100*i)/100,t.style.setProperty(0==s?"--left_xmargin":"--right_xmargin",Math.round(o/2*100)/100+"px"),t.style.setProperty(0==s?"--left_ymargin":"--right_ymargin",Math.round(a/2*100)/100+"px"),t.style.setProperty(0==s?"--left_BubbleWidth":"--right_BubbleWidth",Math.round(100*l)/100+"px"),t.style.setProperty(0==s?"--left_BubbleHeight":"--right_BubbleHeight",Math.round(100*n)/100+"px"),t.style.setProperty(0==s?"--left_x":"--right_x",e[s].x.baseVal.value+"px"),t.style.setProperty(0==s?"--left_y":"--right_y",e[s].y.baseVal.value+"px"),t.style.setProperty(0==s?"--left_width":"--right_width",e[s].width.baseVal.value+"px"),t.style.setProperty(0==s?"--left_height":"--right_height",e[s].height.baseVal.value+"px")}this.removeRect("all"),this.confirmRectNum(),this.isDetect=!1,this.isSendData=!0,this.waitAniBtn(this.isDetectShow,this.delaytime)},doInfo(){let t={};t.detect=this.detectJsonProcess(),t.menuList=this.menuJsonProcess(),t.command="template",this.postSetup(t),this.reset()},detectJsonProcess(){let t=JSON.parse(JSON.stringify(c));const e=document.getElementById("image"),s=getComputedStyle(document.documentElement);let r=[];t.Dimensions.push(e.width),t.Dimensions.push(e.height),t.BubbleDimensions.push(parseFloat(s.getPropertyValue("--left_BubbleWidth"))),t.BubbleDimensions.push(parseFloat(s.getPropertyValue("--right_BubbleHeight"))),t.QBlocks.MCQBlock1.qType="QTYPE_MCQ"+this.typeNum,t.QBlocks.MCQBlock1.orig.push(Math.round(parseInt(s.getPropertyValue("--left_x"))+parseInt(s.getPropertyValue("--left_xmargin")))),t.QBlocks.MCQBlock1.orig.push(Math.round(parseInt(s.getPropertyValue("--left_y"))+parseInt(s.getPropertyValue("--left_ymargin"))));for(let i=0;i<this.leftNum;i++)r.push("q"+(i+1));t.QBlocks.MCQBlock1.qNos[0].push(r),t.QBlocks.MCQBlock1.gaps.push(this.left_boxWidth),t.QBlocks.MCQBlock1.gaps.push(this.left_boxHeight),t.QBlocks.MCQBlock2.qType="QTYPE_MCQ"+this.typeNum,t.QBlocks.MCQBlock2.orig.push(Math.round(parseInt(s.getPropertyValue("--right_x"))+parseInt(s.getPropertyValue("--right_xmargin")))),t.QBlocks.MCQBlock2.orig.push(Math.round(parseInt(s.getPropertyValue("--right_y"))+parseInt(s.getPropertyValue("--right_ymargin")))),r=[];for(let i=0;i<this.rightNum;i++)r.push("q"+(this.leftNum.length+(i+1)));return t.QBlocks.MCQBlock2.qNos[0].push(r),t.QBlocks.MCQBlock2.gaps.push(this.right_boxWidth),t.QBlocks.MCQBlock2.gaps.push(this.right_boxHeight),t},menuJsonProcess(){let t={},e=JSON.parse(JSON.stringify(this.menuJson.menu1)),s=JSON.parse(JSON.stringify(this.menuJson.menu2));t.qty=JSON.parse(JSON.stringify(this.menuJson.qty)),t.taste=JSON.parse(JSON.stringify(this.menuJson.taste)),e.forEach(((t,e)=>{t.detection_key="q"+(e+1),delete t.ori_taste,delete t.showTaste})),s.forEach(((t,s)=>{t.detection_key="q"+(e.length+(s+1)),delete t.ori_taste,delete t.showTaste})),t.menu=e.concat(s),t.ordertype=[];for(let r=0;r<t.qty;r++)t.ordertype.push((r+1).toString());for(let r=0;r<t.taste.length;r++)t.ordertype.push(t.taste[r]);return t},postSetup(t){let e=this,s={};s=t,fetch(e.setupUrl,{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then((t=>t.json())).catch((t=>{console.error("Error:",t),e.errorMethod(4)})).then((function(t){"ok"==t.status&&"template"==t.command?(sessionStorage.setItem("detect","complete"),e.$router.push({path:"machineTest"})):e.errorMethod(5)}))},waitAniBtn(t,e){let s=this;s.isSendDataShow=!1,s.time="("+e+")";var r=setInterval((function(){e--,s.time="("+e+")",0==e&&(s.time="",s.isSendDataShow=!0,clearInterval(r))}),1e3)},errorMethod(t,e){this.msgObj.isError=!0,this.msgObj.num=t,this.msgObj.errormsg=e},get_error(t){this.msgObj.isError=t}}},u=d,p=(s("18dc"),s("2877")),m=s("9989"),g=s("f09f"),y=s("9c40"),b=s("05c0"),f=s("0016"),x=s("27f9"),_=s("24e8"),v=s("a370"),C=s("4b7e"),S=s("7f67"),w=s("eebe"),k=s.n(w),N=Object(p["a"])(u,r,i,!1,null,null,null);e["default"]=N.exports;k()(N,"components",{QPage:m["a"],QCard:g["a"],QBtn:y["a"],QTooltip:b["a"],QIcon:f["a"],QInput:x["a"],QDialog:_["a"],QCardSection:v["a"],QCardActions:C["a"]}),k()(N,"directives",{ClosePopup:S["a"]})}}]);